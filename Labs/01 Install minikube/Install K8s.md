## <font color='red'> 1.1 K8s Cluster </font>
Lab demonstrates a possible GitOps workflow using Argo CD and Tekton. We are using Argo CD to setup our Kubernetes clusters dev and prod (in the following we will only use the dev cluster) and Tekton to build and update our example application.

In this lab we're going to:
* install Dev minikube cluster
* enable Ingress controller
* install ArgoCD

---

#### <font color='red'>IMPORTANT:</font> 
<strong>Please ensure you start with a clean environment. 
If you have previously run minikube, you will need to delete the existing instance.</strong>

to stop  minikube:
```
minikube stop
```
to delete  minikube:
```
minikube delete
```

Pre-requisties:
* Kustomize is a standalone tool to customize Kubernetes objects through a kustomization file. Since 1.14, Kubectl also supports the management of Kubernetes objects using a kustomization file.
ensure kustomize has been installed:
```
sudo snap install kustomize 
```



#### <font color='red'>1.1.1  Install Dev minikube Cluster + ArgoCD </font>

start minikube:
```
minikube start --driver=docker --cpus=4 --memory=8192m --profile=dev
```
enable nginx controller:
```
minikube addons enable ingress --profile=dev
```

#### <font color='red'>1.1.2  Install ArgoCD </font>

install ArgoCD:
```
kustomize build clusters/argocd/dev | k apply -f -
```
Note: this will take a few minutes...

verfiy ArgoCD:
```
kubectl get pods -n argocd
```
To deploy our manifests to the cluster we are using the app of apps pattern. For that we have to create a new Application, which manages all other applications (including Argo CD):

kubectl apply -f clusters/apps/dev.yaml


#### <font color='red'>1.1.3  Ingress </font>

add our Ingresses to the /etc/hosts file:
```
sudo echo "`minikube ip --profile=dev` argocd-dev.fake grafana-dev.fake prometheus-dev.fake tekton-dev.fake server-dev.fake" | sudo tee -a /etc/hosts
```
browse to ArgoCD > http://argocd-dev.fake

user: admin

initial password is autogenerated:
```
kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2
```
Note: In the UI of Argo CD we can now see all deployed applications:
---